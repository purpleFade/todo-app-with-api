(this["webpackJsonpreact-typescript-starter-pack"]=this["webpackJsonpreact-typescript-starter-pack"]||[]).push([[0],{16:function(t,e,n){},18:function(t,e,n){"use strict";n.r(e);var o,c=n(1),r=n.n(c),u=n(9),a=n.n(u),i=(n(14),n(15),n(16),n(0)),l=n(3),d=n.n(l);!function(t){t.All="all",t.Active="active",t.Completed="completed"}(o||(o={}));var s=n(4),f=n(5),j=n(2),b="https://mate.academy/students-api";function m(t){return new Promise((function(e){setTimeout(e,t)}))}function p(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"GET",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,o={method:e};return n&&(o.body=JSON.stringify(n),o.headers={"Content-Type":"application/json; charset=UTF-8"}),m(100).then((function(){return fetch(b+t,o)})).then((function(t){if(!t.ok)throw new Error;return t.json()}))}var O,h=function(t){return p(t)},T=function(t,e){return p(t,"POST",e)},v=function(t,e){return p(t,"PATCH",e)},C=function(t){return p(t,"DELETE")},x=function(t){return C("/todos/".concat(t))},y=12048;!function(t){t.cantLoadTodos="Unable to load todos",t.titleIsEmpty="Title should not be empty",t.cantAddTodo="Unable to add a todo",t.cantDeleteTodo="Unable to delete a todo",t.cantUpdateTodo="Unable to update a todo"}(O||(O={}));var g=Object(c.createContext)({todos:[],status:o.All,setTodos:function(){},setStatus:function(){},deleteTodo:function(){},selectedTodoIds:[],setSelectedTodoIds:function(){},handleToggleCompleted:function(){},clearCompleted:function(){},todoTitle:"",setTodoTitle:function(){},tempTodo:null,setTempTodo:function(){},addTodo:function(){},error:null,setError:function(){},loading:!1,setLoading:function(){},updateTodo:function(){},handleToggleCompletedAll:function(){},handleError:function(){}}),k=function(t){var e=t.children,n=Object(c.useState)([]),r=Object(j.a)(n,2),u=r[0],a=r[1],l=Object(c.useState)(o.All),d=Object(j.a)(l,2),b=d[0],m=d[1],p=Object(c.useState)([]),h=Object(j.a)(p,2),C=h[0],k=h[1],_=Object(c.useState)(""),N=Object(j.a)(_,2),S=N[0],E=N[1],A=Object(c.useState)(null),I=Object(j.a)(A,2),w=I[0],L=I[1],U=Object(c.useState)(null),D=Object(j.a)(U,2),F=D[0],B=D[1],P=Object(c.useState)(!1),J=Object(j.a)(P,2),M=J[0],H=J[1],R=Object(c.useCallback)((function(t){B(t),setTimeout((function(){return B(null)}),2e3)}),[]),G=Object(c.useCallback)((function(t){k((function(e){return[].concat(Object(f.a)(e),[t])})),x(t).then((function(){setTimeout((function(){a((function(e){return e.filter((function(e){return e.id!==t}))}))}),500)})).catch((function(){R(O.cantDeleteTodo)})).finally((function(){return setTimeout((function(){return k((function(e){return e.filter((function(e){return e!==t}))}))}),500)}))}),[R]),K=Object(c.useCallback)((function(){var t=u.filter((function(t){return t.completed}));k((function(e){return[].concat(Object(f.a)(e),Object(f.a)(t.map((function(t){return t.id}))))}));var e=t.map((function(t){return x(t.id)}));Promise.all(e).then((function(){a((function(t){return t.filter((function(t){return!t.completed}))}))})).catch((function(){return R(O.cantDeleteTodo)})).finally((function(){return t.map((function(t){return k((function(e){return e.filter((function(e){return e!==t.id}))}))}))}))}),[u,R]),W=Object(c.useCallback)((function(t){k((function(e){return[].concat(Object(f.a)(e),[t.id])}));var e=Object(s.a)(Object(s.a)({},t),{},{completed:!t.completed});(function(t){var e=t.id,n=t.completed;return v("/todos/".concat(e),{completed:n})})(e).then((function(t){a((function(n){var o=Object(f.a)(n),c=o.findIndex((function(t){return t.id===e.id}));return o[c]=t,o}))})).catch((function(){return R(O.cantUpdateTodo)})).finally((function(){return setTimeout((function(){return k((function(e){return e.filter((function(e){return e!==t.id}))}))}))}))}),[R]),q=Object(c.useCallback)((function(){if(u.every((function(t){return t.completed}))){var t=u.map((function(t){return W(t),t}));a(t)}else{var e=u.map((function(t){return t.completed||W(t),t}));a(e)}}),[u,W]),z=Object(c.useCallback)((function(t){H(!0),k((function(t){return[].concat(Object(f.a)(t),[0])})),L({id:0,userId:y,title:t,completed:!1}),function(t){var e=t.userId,n=t.title,o=t.completed;return T("/todos",{userId:e,title:n,completed:o})}({userId:y,title:t,completed:!1}).then((function(t){E(""),setTimeout((function(){a((function(e){return[].concat(Object(f.a)(e),[t])}))}),500)})).catch((function(){R(O.cantAddTodo)})).finally((function(){H(!1),k((function(t){return t.filter((function(t){return 0!==t}))})),setTimeout((function(){return L(null)}),500)}))}),[R]),Q=Object(c.useCallback)((function(t){H(!0),k((function(e){return[].concat(Object(f.a)(e),[t.id])})),function(t){var e=t.id,n=t.title;return v("/todos/".concat(e),{title:n})}(t).then((function(){a((function(e){return e.map((function(e){return e.id===t.id?t:e}))}))})).catch((function(){R(O.cantUpdateTodo)})).finally((function(){k((function(e){return e.filter((function(e){return e!==t.id}))})),H(!1)}))}),[R]),V=Object(c.useMemo)((function(){return{todos:u,status:b,setTodos:a,setStatus:m,deleteTodo:G,selectedTodoIds:C,setSelectedTodoIds:k,handleToggleCompleted:W,clearCompleted:K,todoTitle:S,setTodoTitle:E,tempTodo:w,setTempTodo:L,addTodo:z,error:F,setError:B,loading:M,setLoading:H,updateTodo:Q,handleToggleCompletedAll:q,handleError:R}}),[u,b,C,G,W,K,S,w,F,M,Q,q,z,R]);return Object(i.jsx)(g.Provider,{value:V,children:e})},_=function(t){var e=t.uncompletedTodosCount,n=t.status,r=t.setStatus,u=t.isSomeTodosCompleted,a=Object(c.useContext)(g).clearCompleted;return Object(i.jsxs)("footer",{className:"todoapp__footer","data-cy":"Footer",children:[Object(i.jsx)("span",{className:"todo-count","data-cy":"TodosCounter",children:"".concat(e," items left")}),Object(i.jsxs)("nav",{className:"filter","data-cy":"Filter",children:[Object(i.jsx)("a",{href:"#/",className:d()("filter__link",{selected:n===o.All}),"data-cy":"FilterLinkAll",onClick:function(){return r(o.All)},children:"All"}),Object(i.jsx)("a",{href:"#/active",className:d()("filter__link",{selected:n===o.Active}),"data-cy":"FilterLinkActive",onClick:function(){return r(o.Active)},children:"Active"}),Object(i.jsx)("a",{href:"#/completed",className:d()("filter__link",{selected:n===o.Completed}),"data-cy":"FilterLinkCompleted",onClick:function(){return r(o.Completed)},children:"Completed"})]}),Object(i.jsx)("button",{type:"button",className:d()("todoapp__clear-completed",{disabled:!u}),"data-cy":"ClearCompletedButton",disabled:!u,onClick:a,children:"Clear completed"})]})},N=r.a.memo((function(t){var e=t.todo,n=Object(c.useContext)(g),o=n.deleteTodo,r=n.selectedTodoIds,u=n.handleToggleCompleted,a=n.updateTodo,l=n.loading,f=n.error,b=Object(c.useState)(!1),m=Object(j.a)(b,2),p=m[0],O=m[1],h=Object(c.useState)(e.title),T=Object(j.a)(h,2),v=T[0],C=T[1],x=function(t){t.preventDefault(),v?v.trim()!==e.title.trim()?(a(Object(s.a)(Object(s.a)({},e),{},{title:v.trim()})),O(!1)):O(!1):o(e.id)},y=Object(c.useRef)(null);return Object(c.useEffect)((function(){p&&y.current&&y.current.focus()}),[p,f]),Object(i.jsxs)("div",{"data-cy":"Todo",className:d()("todo",{completed:e.completed}),onDoubleClick:function(){return O(!0)},children:[Object(i.jsx)("label",{className:"todo__status-label",children:Object(i.jsx)("input",{"data-cy":"TodoStatus",type:"checkbox",className:"todo__status",onChange:function(){return u(e)},checked:e.completed})}),p?Object(i.jsx)("form",{onSubmit:x,onBlur:x,children:Object(i.jsx)("input",{type:"text",className:"todo__title-field",placeholder:"Empty todo will be deleted",ref:y,value:v,onChange:function(t){return C(t.target.value)},onKeyUp:function(t){"Escape"===t.key&&(O(!1),C(e.title))}})}):Object(i.jsxs)(i.Fragment,{children:[Object(i.jsx)("span",{"data-cy":"TodoTitle",className:"todo__title",children:l?v:e.title}),Object(i.jsx)("button",{type:"button",className:"todo__remove","data-cy":"TodoDelete",onClick:function(){return o(e.id)},children:"\xd7"})]}),Object(i.jsxs)("div",{"data-cy":"TodoLoader",className:d()("modal overlay",{"is-active":r.includes(e.id)}),children:[Object(i.jsx)("div",{className:"modal-background has-background-white-ter"}),Object(i.jsx)("div",{className:"loader"})]})]})})),S=function(t){var e=t.todos,n=Object(c.useContext)(g).tempTodo;return Object(i.jsxs)("section",{className:"todoapp__main","data-cy":"TodoList",children:[e.map((function(t){return Object(i.jsx)(N,{todo:t},t.id)})),n&&Object(i.jsx)(N,{todo:n},null===n||void 0===n?void 0:n.id)]})},E=function(){var t=Object(c.useContext)(g),e=t.error,n=t.setError;return Object(i.jsxs)("div",{className:"notification is-danger is-light has-text-weight-normal",children:[Object(i.jsx)("button",{"data-cy":"HideErrorButton",type:"button",className:"delete",onClick:function(){return n(null)}}),e]})},A=function(t){var e=t.isEveryTodosCompleted,n=Object(c.useContext)(g),o=n.todoTitle,r=n.setTodoTitle,u=n.addTodo,a=n.setError,l=n.loading,f=n.todos,b=n.setTodos,m=Object(c.useState)(f.every((function(t){return t.completed}))),p=Object(j.a)(m,2),h=p[0],T=p[1],v=Object(c.useRef)(null);Object(c.useEffect)((function(){f.every((function(t){return t.completed}))?T(!0):T(!1)}),[f]);Object(c.useEffect)((function(){v.current&&!v.current.disabled&&v.current.focus()}));return Object(i.jsxs)("header",{className:"todoapp__header",children:[Object(i.jsx)("button",{type:"button",className:d()("todoapp__toggle-all text-invisible",{active:e}),"data-cy":"ToggleAllButton",onClick:function(){T(!h),b(f.map((function(t){return Object(s.a)(Object(s.a)({},t),{},{completed:!h})})))},children:" "}),Object(i.jsx)("form",{onSubmit:function(t){if(null===t||void 0===t||t.preventDefault(),!o.trim())return a(O.titleIsEmpty),void setTimeout((function(){return a(null)}),2e3);u(o.trim())},children:Object(i.jsx)("input",{"data-cy":"NewTodoField",type:"text",className:"todoapp__new-todo",placeholder:"What needs to be done?",ref:v,value:o,onChange:function(t){return r(t.target.value)},disabled:l})})]})},I=function(){var t=Object(c.useContext)(g),e=t.todos,n=t.setTodos,r=t.status,u=t.setStatus,a=t.error,l=t.setError;Object(c.useEffect)((function(){var t;(t=y,h("/todos?userId=".concat(t))).then(n).catch((function(){return l(O.cantLoadTodos)}))}),[n,l]);var d=Object(c.useCallback)((function(){return function(t){var e=t.todos;switch(t.status){case o.Active:return e.filter((function(t){return!t.completed}));case o.Completed:return e.filter((function(t){return t.completed}));default:return e}}({todos:e,status:r})}),[e,r]),s=Object(c.useMemo)((function(){return d()}),[d]),f=e.filter((function(t){return!t.completed})).length,j=e.some((function(t){return t.completed})),b=s.every((function(t){return t.completed}));return Object(i.jsxs)("div",{className:"todoapp",children:[Object(i.jsx)("h1",{className:"todoapp__title",children:"todos"}),Object(i.jsxs)("div",{className:"todoapp__content",children:[Object(i.jsx)(A,{isEveryTodosCompleted:b}),Object(i.jsx)(S,{todos:s}),e.length>0&&Object(i.jsx)(_,{uncompletedTodosCount:f,status:r,setStatus:u,isSomeTodosCompleted:j}),a&&e.length>0&&Object(i.jsx)(E,{})]})]})};a.a.render(Object(i.jsx)(r.a.StrictMode,{children:Object(i.jsx)(k,{children:Object(i.jsx)(I,{})})}),document.getElementById("root"))}},[[18,1,2]]]);
//# sourceMappingURL=main.6bc878b6.chunk.js.map